# The Tobacco Club Firebase Schema Design Document

## 1: Define Data Entities

Define the data entities that will be used for data storage and manipulation. Data entities represent the various object types or concepts that our site will interact with. Here is a list of data entities for our site:
- Users
- Smoking Journals
- Milestones/Achievements
- Support Groups
- Resources/Articles

## 2: Data Modelling

```javascript
// Schema design using Firebase Firestore
// Users Collection:
// Document per user, using their unique user IDs.
// Fields: uid (User ID), email, name, DOB, joined_date, contact number, support_group_id, etc.

// Smoking Journals Collection:
// Document per journal entry, with a unique ID.
// Fields: user_id, entry_date, number_of_cigarettes, notes, etc.

// Milestones/Achievements Collection:
// Document per milestone or achievement.
// Fields: title, description, reward, required_actions, etc.

// Support Groups Collection:
// Document per support group.
// Fields: name, description, members (an array of user IDs), created_by, etc.

// Resources/Articles Collection:
// Document per resource or article.
// Fields: title, content, author, category, created_date, likes, comments, etc.
```

## 3: Establishing Relationships

Establishing relationships between entities is a critical aspect of database design in Firestore. Relationships facilitate the efficient retrieval of related information by establishing connections between various data components. 

The following examples demonstrate the implementation of relationships for The Tobacco Club:

1. Linking Journal Entries to Users:

In Firestore, the association between journal entries and their respective creators can be established by incorporating a user_id field within each journal entry document. The user_id refers to the unique identifier (UID) of the user responsible for creating the journal entry.

When a user logs a new journal entry, a new document is created in the "Smoking Journals" collection. This document provides details pertaining to the journal entry, including the date, quantity of cigarettes consumed, and accompanying notes. Furthermore, the entry incorporates the user_id field, which is specifically assigned to the unique identifier (UID) of the user responsible for creating it.

This association facilitates seamless querying and retrieval of journal entries generated by a particular user or the display of the author's details (such as name and profile picture) alongside each journal entry.

2. Membership in Support Groups:

Users have the opportunity to participate in support groups within the Tobacco Club platform, enabling them to establish connections with fellow individuals who share the common goal of smoking cessation. In order to establish the desired relationship, it is recommended to create a designated field within the user's document, referred to as support_group_id. The purpose of this field is to store the identifier of the support group to which the user is affiliated.

Upon a user's enrollment in a support group, the support_group_id field is updated with the corresponding ID of the selected group. This connection establishes a link between the user and the support group they have enrolled in.

The aforementioned relationship enables the retrieval of all members belonging to a particular support group. This can be achieved by querying the "Users" collection for users whose support_group_id matches the specified value. Additionally, it simplifies the process of showcasing the support groups in which a user is actively involved.

**In both of these instances, Firestore's capability to reference and link data across collections enables the establishment of significant relationships between entities. The relationships established within The Tobacco Club facilitate efficient query execution and data retrieval, thereby ensuring a seamless user experience.**


## 4. Security Rules

```javascript
rules_version = '';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Smoking Journals collection
    match /smoking_journals/{journalId} {
      allow read, write: if request.auth != null && request.auth.uid == request.resource.data.user_id;
    }
    
    // Define similar rules for other collections as needed.
    
  }
}
```


## 5. Charts and Documentation

To effectively document your Firebase schema, it is recommended to create charts and corresponding documentation:
  - An Entity-Relationship Diagram (ERD) is utilised to visually represent the structure of data and its relationships.
  - This document aims to provide a comprehensive overview of the fields and data types associated with each document.
  - This document aims to outline the security rules and access control logic in place for the system.
  - This document aims to provide an overview of data access patterns and common queries. It will discuss the various ways in which data can be accessed and the typical queries that are frequently used in data retrieval. Data access patterns refer to the methods and techniques employed to retrieve data from a database or other data storage systems. These patterns are designed to optimise the efficiency


## 6. Testing and Optimization

## Testing and Optimization for the Tobacco Club

### Testing

**1. Firebase Schema Unit Testing**

* Create unit tests to ensure the correctness of database reads and writes for each collection and document type. For instance:
    * Implement unit tests to verify the functionality of reading and writing user data, including the ability to update profile information.
    * Perform comprehensive testing on journal entries to verify the functionality of user-initiated actions such as creation, editing, and deletion, while ensuring that unauthorized users are unable to modify said entries.

**2. Data Relationship Integration Testing**

* Perform integration tests that encompass diverse scenarios where data relationships are crucial.
* Validate the functionality of joining and leaving support groups to ensure accurate updates of user documents.
* Ensure that users' milestones trigger the appropriate updates to associated data, such as rewards or notifications.

**3. Security Testing**

* Conduct security testing to verify the efficacy of security rules in preventing unauthorised access.
* Perform testing on scenarios involving unauthorised users attempting to access or modify data. Ensure access is denied in accordance with security rules.
* Ensure that authenticated users are able to execute anticipated actions without encountering any security violations.

**4. Scalability Performance Testing**

* Conduct a stress test on the Firestore database to assess its performance under high loads.
* Design a simulation to replicate a scenario where a substantial volume of users concurrently log journal entries, participate in support groups, and accomplish milestones.
* Monitor database response times, resource consumption, and system stability throughout the stress test.

### Optimization

**5. Query Optimisation**

* Analyse the commonly executed queries in "TheTobaccoClub" and leverage Firestore's indexing system to enhance their performance. Here are some examples:
    * Optimise the efficiency of common queries, such as retrieving journal entries by date or support groups by membership, by setting appropriate indexes.

**6. Data Structure Review**

* Continuously evaluate the performance of your data structures and make necessary optimisations as needed. Please take into consideration:
    * If certain queries exhibit slow performance, it is recommended to assess the potential benefits of data denormalization or restructuring in order to optimise query performance.

**7. Batch Operations**

* Use Firestore's batch write operations for improved efficiency:
    * To optimise efficiency and reduce the number of requests, it is recommended to bundle multiple related actions performed by users into batch writes.

**8. Caching for Improved Responsiveness**

* Implement caching mechanisms to optimise server requests and enhance user experience.
* Leverage Firestore's offline capabilities to empower users with seamless data access, ensuring app responsiveness even in offline scenarios.

**9. Performance Insights Monitoring**

* Implement real-time monitoring of the Firestore database utilising Firebase's monitoring tools.
* Configure alerts to proactively identify and address performance issues, including unusual activity, slow queries, and errors.

**10. Scaling Strategies**

* Ensure scalability as your user base expands:
    * Continuously monitor usage patterns and make necessary adjustments to Firebase Blaze plan quotas or consider implementing sharding strategies to effectively handle increased demand.

**11. Error Handling**

* Implement robust error handling mechanisms to ensure reliable and efficient error management.
* Ensure that the application gracefully handles failed database operations or security rule violations, providing meaningful error messages to users.

**12. Regular Schema and Rule Reviews**

* Ensure regular reviews of your database schema and security rules are scheduled.
* Continuously update the schema and rules of your application to adapt to evolving requirements and maintain optimal security and performance.


## Backup and Recovery Procedures for The Tobacco Club

The implementation of backup and recovery strategies is of utmost importance in ensuring the protection of data for The Tobacco Club stop smoking programme. These strategies are implemented to guarantee the accessibility and protection of data, mitigating the risks associated with unforeseen events such as accidental deletions, system failures, or data corruption.

**Regular Data Backups**

Regular data backups are essential for ensuring the safety and security of important information.

* **Frequency:** To ensure data integrity and minimize the risk of data loss, it is recommended to establish a recurring automated backup schedule for your Firestore database. The frequency at which backups are performed is contingent upon the quantity of data and the rate at which it undergoes modifications. Daily or hourly backups are frequently selected options.
* **Retention:** Establishing the Duration for Backup Data Retention. The retention of backups for a designated duration enables the retrieval of data from various timeframes, should the need arise. For instance, it is recommended to maintain daily backups for a period of 30 days.

**Automated Backup Tools**

* **Firebase Cloud Firestore:** Firebase Cloud Firestore provides users with a convenient and integrated backup and restore feature. The Firebase CLI or the Firebase Console can be utilized to initiate manual backups or establish automated backups.
* **Redundancy and Disaster Recovery:** Redundancy and disaster recovery are crucial aspects of ensuring the continuity and resilience of systems and operations. By implementing redundancy measures, organisations can mitigate the risk of single points of failure and minimize the impact of potential disruptions. Additionally, having a robust disaster recovery plan in place ensures that the business can recover quickly and efficiently from any disruptive event.
* **Firestore Redundancy:** Firestore operates across multiple data centers to ensure redundancy. This feature aids in maintaining data accessibility even in the occurrence of a data center outage or malfunction.

**Disaster Recovery Plan**

This document outlines the necessary steps to create a comprehensive disaster recovery plan, which encompasses the procedures required to restore data in the event of a significant outage or catastrophic event. This may entail implementing data replication across multiple geographic regions or devising backup strategies that account for different failure scenarios.

**Data Versioning**

Ensure the maintenance of versioned copies of both your schema and application code. This ensures the ability to restore both the data and the application to a state of consistency.

**Security and Access Control**

Security and access control are crucial aspects to consider in any system or network. These measures are implemented to protect sensitive information and ensure that only authorised individuals have access to it. By implementing robust security measures, organisations can mitigate the risk of unauthorised access and data breaches.

* **Access Control:** Access control is implemented to restrict unauthorised access to backup data. Access to backup files and tools should be restricted to authorised personnel to prevent data breaches and unauthorised access.
* **Encryption:** Encryption is a crucial measure to safeguard backup data from potential security threats. It is imperative to implement encryption protocols during both storage and transmission processes. This ensures that the data remains protected and inaccessible to unauthorised individuals.

**Evaluation of Recovery Procedures**

**Regular Testing:** It is recommended to conduct periodic tests of your data recovery procedures to verify the successful restoration of data from backups. This encompasses the evaluation of both partial data recovery, such as the restoration of specific documents, and full database recovery.

**Monitoring and Alerts:** Monitoring and alerts are essential components of an effective system. By continuously monitoring various parameters and conditions, potential issues can be identified and addressed promptly. Alerts serve as notifications to relevant personnel, ensuring timely response and resolution. Alerts should be established to notify the team promptly in the event of backup failures or other critical events that demand immediate attention.

**Documentation**

It is essential to maintain comprehensive and current documentation of backup and recovery procedures. It provides a comprehensive record of the project's design, development, and implementation.


## 8: Deployment and Maintenance Procedures for The Tobacco Club

### Deployment

**1. Firebase Console**

* Use the Firebase Console to deploy the Firestore schema and security rules, and configure hosting for the application.

**2. Firestore Security Rules**

* Deploy Firestore security rules for ensuring proper data access control. Ensure that security rules are in alignment with the stakeholders and application's data privacy and security requirements.

**3. Firebase CLI**

* Utilize the Firebase Command Line Interface (CLI) to deploy the Firestore schema and security rules. To manage your Firebase project, you can install the Firebase CLI locally.
* To deploy the schema, excute the following commands:

```shell
# Log in to your Firebase account
firebase login

# Set your Firebase project (if not already set)
firebase use --add

# Deploy Firestore rules and indexes
firebase deploy --only firestore:rules,firestore:indexes
```


**4. Hosting**

* Utilize Firebase Hosting for deploying the application. Firebase Hosting empowers the application to serve web content, encompassing HTML, CSS, and JavaScript, with SSL encryption and automated scaling.
* To deploy the frontend code, execute the follwing command:

```shell
# Deploy hosting content
firebase deploy --only hosting
```
  

**5. Database Population (Optional)**

* If there are predefined data or initial configurations, scripts or Firebase functions come in handy when populating the Firestore database with this data during deployment.

**6. Continuous Integration/Continuous Deployment (CI/CD)**

* Consider implementing CI/CD pipelines if feasible. CI/CD automates the deployment process, enabling developers to push code to a repository and trigger automatic deployment to the production environment.

**7. Monitoring and Testing**

* Following deployment, consistently monitor the application and database, leveraging Firebase's monitoring tools, and conduct supplementary testing in the production environment to verify proper functionality.

### Maintenance

**8. Documentation**

* Revise documentation to align with the updated deployment process. Provide instructions on how to utilise the deployed application, elaborate on the database schema, and include any pertinent details pertaining to The Tobacco Club.

**9. Routine Maintenance**

* After deploying your Firebase database, it is important to adhere to best practices for its maintenance and updates. This involves regularly reviewing and updating security rules as necessary.
* Monitoring database performance and optimising queries
* Implement regular backups and data retention policies.
* Keeping up-to-date with Firebase updates and new features to leverage improvements and enhancements.

